<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">

<head>
  <title>Sudoku</title>
  
  <style type="text/css">
    table.frame {
      border-spacing: 0px;
      border-collapse: separate;
      border:2px solid black;
    }
    table.boxframe {
      border-spacing: 0px;
      border-collapse: separate;
      border:1px solid black;
    }
    td.box {padding:0; margin:0;}
    td.cell {
      padding:0;
      margin:0;
      border: 1px solid black;
      width: 51px;
      height: 53px;
      text-align: center;
      font-size: xx-large;
      background-color: white;
    }
  </style>

  <!--  tr {background-color:green;} -->
  <!--  td.box {border:2px solid blue;} -->
  <!--  table.frame {border-collapse: collapse;} -->
  <!--  table.boxframe {border:2px solid red;} -->

</head>

<body>
<b>Note:</b><br/>
To set up the grid highlight the grid cells using the left mouse button and type a number, 1 to 9, to toggle that number in the cell as a possibility. If no numbers appear in a cell then that means all numbers, 1 to 9 are possibilities. You can also use the Space Key to toggle the display of all possible numbers and blank - although note these basically mean the same thing.
<br/>
<br/>

<table><tr>

<!-- 3box x 3box table -->
<td><table class="frame">
  <!-- First Row -->
  <tr>
    <td class="box">
      <!-- 3x3 within-box table -->
      <table class="boxframe">
        <tr>
          <td class="cell" id="c00"></td>
          <td class="cell" id="c01"></td>
          <td class="cell" id="c02"></td>
        </tr>
        <tr>
          <td class="cell" id="c09"></td>
          <td class="cell" id="c10"></td>
          <td class="cell" id="c11"></td>
        </tr>
        <tr>
          <td class="cell" id="c18"></td>
          <td class="cell" id="c19"></td>
          <td class="cell" id="c20"></td>
        </tr>
      </table>
    </td>

    <td class="box">
      <!-- 3x3 within-box table -->
      <table class="boxframe">
        <tr>
          <td class="cell" id="c03"></td>
          <td class="cell" id="c04"></td>
          <td class="cell" id="c05"></td>
        </tr>
        <tr>
          <td class="cell" id="c12"></td>
          <td class="cell" id="c13"></td>
          <td class="cell" id="c14"></td>
        </tr>
        <tr>
          <td class="cell" id="c21"></td>
          <td class="cell" id="c22"></td>
          <td class="cell" id="c23"></td>
        </tr>
      </table>
    </td>

    <td class="box">
      <!-- 3x3 within-box table -->
      <table class="boxframe">
        <tr>
          <td class="cell" id="c06"></td>
          <td class="cell" id="c07"></td>
          <td class="cell" id="c08"></td>
        </tr>
        <tr>
          <td class="cell" id="c15"></td>
          <td class="cell" id="c16"></td>
          <td class="cell" id="c17"></td>
        </tr>
        <tr>
          <td class="cell" id="c24"></td>
          <td class="cell" id="c25"></td>
          <td class="cell" id="c26"></td>
        </tr>
      </table>
    </td>
  </tr>

  <!-- Second Row -->
  <tr>
    <td class="box">
      <!-- 3x3 within-box table -->
      <table class="boxframe">
        <tr>
          <td class="cell" id="c27"></td>
          <td class="cell" id="c28"></td>
          <td class="cell" id="c29"></td>
        </tr>
        <tr>
          <td class="cell" id="c36"></td>
          <td class="cell" id="c37"></td>
          <td class="cell" id="c38"></td>
        </tr>
        <tr>
          <td class="cell" id="c45"></td>
          <td class="cell" id="c46"></td>
          <td class="cell" id="c47"></td>
        </tr>
      </table>
    </td>

    <td class="box">
      <!-- 3x3 within-box table -->
      <table class="boxframe">
        <tr>
          <td class="cell" id="c30"></td>
          <td class="cell" id="c31"></td>
          <td class="cell" id="c32"></td>
        </tr>
        <tr>
          <td class="cell" id="c39"></td>
          <td class="cell" id="c40"></td>
          <td class="cell" id="c41"></td>
        </tr>
        <tr>
          <td class="cell" id="c48"></td>
          <td class="cell" id="c49"></td>
          <td class="cell" id="c50"></td>
        </tr>
      </table>
    </td>

    <td class="box">
      <!-- 3x3 within-box table -->
      <table class="boxframe">
        <tr>
          <td class="cell" id="c33"></td>
          <td class="cell" id="c34"></td>
          <td class="cell" id="c35"></td>
        </tr>
        <tr>
          <td class="cell" id="c42"></td>
          <td class="cell" id="c43"></td>
          <td class="cell" id="c44"></td>
        </tr>
        <tr>
          <td class="cell" id="c51"></td>
          <td class="cell" id="c52"></td>
          <td class="cell" id="c53"></td>
        </tr>
      </table>
    </td>
  </tr>

  <!-- Third Row -->
  <tr>
    <td class="box">
      <!-- 3x3 within-box table -->
      <table class="boxframe">
        <tr>
          <td class="cell" id="c54"></td>
          <td class="cell" id="c55"></td>
          <td class="cell" id="c56"></td>
        </tr>
        <tr>
          <td class="cell" id="c63"></td>
          <td class="cell" id="c64"></td>
          <td class="cell" id="c65"></td>
        </tr>
        <tr>
          <td class="cell" id="c72"></td>
          <td class="cell" id="c73"></td>
          <td class="cell" id="c74"></td>
        </tr>
      </table>
    </td>

    <td class="box">
      <!-- 3x3 within-box table -->
      <table class="boxframe">
        <tr>
          <td class="cell" id="c57"></td>
          <td class="cell" id="c58"></td>
          <td class="cell" id="c59"></td>
        </tr>
        <tr>
          <td class="cell" id="c66"></td>
          <td class="cell" id="c67"></td>
          <td class="cell" id="c68"></td>
        </tr>
        <tr>
          <td class="cell" id="c75"></td>
          <td class="cell" id="c76"></td>
          <td class="cell" id="c77"></td>
        </tr>
      </table>
    </td>

    <td class="box">
      <!-- 3x3 within-box table -->
      <table class="boxframe">
        <tr>
          <td class="cell" id="c60"></td>
          <td class="cell" id="c61"></td>
          <td class="cell" id="c62"></td>
        </tr>
        <tr>
          <td class="cell" id="c69"></td>
          <td class="cell" id="c70"></td>
          <td class="cell" id="c71"></td>
        </tr>
        <tr>
          <td class="cell" id="c78"></td>
          <td class="cell" id="c79"></td>
          <td class="cell" id="c80"></td>
        </tr>
      </table>
    </td>
  </tr>
</table></td>

<td><table>

  <tr><td>
    KEY COMMANDS<br/>
  </td></tr>
  <tr><td>
    X: Create New Puzzle (<span id="level">Easy</span>)<br/>
    T: Toggle level<br/>
  </td></tr>
  <tr><td>
    S: Save Position<br/>
    &nbsp;Current Position: <span id="position">1/1</span><br/>
  </td></tr>
  <tr><td>
    W: Attempt to Solve with Methods</br>
  </td></tr>
  <tr><td>
    Y: Clear Grid<br/>
    Z: Fix/Unfix Grid<br/>
  </td></tr>
</table></td>



</tr></table>

</body>

<script type="text/javascript">

  // ---------------------------------------------------------------------------
  // Set up static global variables
  // ---------------------------------------------------------------------------

  var R = 0;
  var C = 1;
  var B = 2;

  var SETBIT       = 1;
  var UNSETBIT     = 2;
  var SETALLBITS   = 3;
  var UNSETALLBITS = 4;

  level_element = document.getElementById("level");
  position_element = document.getElementById("position");

</script>

<script src="Cell.js"></script>
<script src="Action.js"></script>
<script src="Grid.js"></script>
<script src="Step.js"></script>
<script src="History.js"></script>
<script src="Sudoku.js"></script>

<script type="text/javascript">


  // ---------------------------------------------------------------------------
  // Create new Sudoku object
  // ---------------------------------------------------------------------------

  var sudoku = new Sudoku();

  // ---------------------------------------------------------------------------
  // Handle key presses
  // ---------------------------------------------------------------------------

  window.addEventListener("keyup", function (event) {

    if (event.defaultPrevented) {
      return; // Do nothing if the event was already processed
    }

    if (sudoku.selection != -1) {
      // DEAL WITH SELECTION CASES

      var cell = sudoku.grid.getCellRef(sudoku.selection);

      switch (event.key.toUpperCase()) {
        case "SPACEBAR":
        case " ":
          if (!cell.isFixed()) {
            var id = '' + sudoku.selection;
            id = "c"+"00".substring(id.length) + id;
            document.getElementById(id).innerHTML = '';
          }
          break;

        case "1":
        case "2":
        case "3":
        case "4":
        case "5":
        case "6":
        case "7":
        case "8":
        case "9":
          if (!cell.isFixed()) {
            var bit = parseInt(event.key)-1;
            if (cell.isBitSet(bit)) {
              if (cell.count() == 1 && !cell.isFinalised()) {
                // Change from bit display to finalised number display
                cell.finaliseCell();

                var id = '' + sudoku.selection;
                id = "c"+"00".substring(id.length) + id;
                document.getElementById(id).innerHTML = event.key;
              } else {
                // Unset bit
                cell.unfinaliseCell();
                cell.unsetBit(bit);
              }
            } else {
              // Set bit
              cell.unfinaliseCell();
              cell.setBit(bit);
            }
          }
          //alert("changed cell="+cell);
          break;

        default:
          break;
      }
    } else {
      // DEAL WITH NON-SELECTION CASES

    }

    // DEAL WITH OTHER CASES

    switch (event.key.toUpperCase()) {


      case "S": // Save Position
        sudoku.saveGrid();
        position_element.innerHTML = (sudoku.historyIndex + 1) + "/" + sudoku.history.length;
        break;

      case "T": // Toggle level
        sudoku.newLevel = (sudoku.newLevel % 4) + 1;
        level_element.innerHTML = sudoku.levelToText(sudoku.newLevel);
        break;

      case "W": // Attempt to Solve with Methods
        sudoku.selection = -1;
        //sudoku.solveAll();
        //sudoku.doSteps();
        //sudoku.locked = false;
        sudoku.paint();
        break;

      case "X": // Key X - create new puzzle
        // Create new puzzle
        sudoku.selection = -1;
        sudoku.locked = true;
        sudoku.creating = true;
        var level; // int
        do {
          level = sudoku.newPuzzle();
          sudoku.steps = [];
        } while (level != sudoku.newLevel);

        sudoku.valid = sudoku.grid.isValid();
        sudoku.saveGrid();
        position_element.innerHTML = (sudoku.historyIndex + 1) + "/" + sudoku.history.length;
        sudoku.creating = false;
        sudoku.locked = false;

        sudoku.paint();
        //alert(sudoku.grid);

        break;

      case "Y": // Clear Grid
        sudoku.selection = -1;
        sudoku.clearGrid();
        sudoku.paint();
        break;

      case "Z": // Fix/Unfix Grid
        sudoku.selection = -1;
        var isFixed = false; // boolean
        for (var i = 0; i < 81; i++) {
          if (sudoku.grid.getCellRef(i).isFixed()) {
            isFixed = true;
            break;
          }
        }
        if (isFixed) {
          sudoku.grid.unfix();
        } else {
          sudoku.grid.fix();
        }
        sudoku.paint();
        break;

      default:
        return; // Quit when this doesn't handle the key event.
    }
    // Cancel the default action to avoid it being handled twice
    event.preventDefault();
  }, true);
  // the last option dispatches the event to the listener first,
  // then dispatches event to window

</script>

</html>
